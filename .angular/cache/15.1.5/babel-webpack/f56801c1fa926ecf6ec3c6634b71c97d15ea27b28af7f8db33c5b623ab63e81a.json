{"ast":null,"code":"import { Component, Injectable } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nexport class CadastrarAnuncioComponent {\n  constructor(fb, anuncioservice, categoriaService, toast) {\n    this.fb = fb;\n    this.anuncioservice = anuncioservice;\n    this.categoriaService = categoriaService;\n    this.toast = toast;\n    this.categorias = [];\n    this.empresaId = 0;\n    this.categoriaId = 0;\n    this.nomeArquivo = '';\n    this.imagemUrl = \"../../../../assets/images/icons/upload.png\";\n    this.form = this.fb.group({\n      descricao: [null, [Validators.required, Validators.minLength(3), Validators.maxLength(150)]],\n      data_validade: [null, [Validators.required]],\n      preco: [null, [Validators.required]],\n      categoria: [null, [Validators.required]],\n      imagem: [null, [Validators.required]]\n    });\n  }\n  ngOnInit() {\n    this.BuscarCategorias();\n  }\n  get f() {\n    return this.form.controls;\n  }\n  onChange(event) {\n    const selectedFiles = event.srcElement.files;\n    document.getElementById('imageLabel').innerHTML = selectedFiles[0].name;\n  }\n  salvarAnuncio() {\n    debugger;\n    this.categoriaId = parseInt(document.getElementById('categoriaId').value);\n    this.empresaId = 3;\n    let anuncio = {\n      descricao: this.f.descricao.value,\n      data_validade: this.f.data_validade.value,\n      preco: this.f.preco.value,\n      ativo: true,\n      is_destaque: false,\n      categoria_id: this.categoriaId,\n      empresa_id: this.empresaId,\n      imagem_url: this.nomeArquivo\n    };\n    this.anuncioservice.SalvarAnuncio(anuncio).subscribe(() => {\n      this.toast.success('Anúncio cadastrado com sucesso!', 'Sucesso');\n    }, erro => {\n      this.toast.error('Erro ao cadastrar o anúncio.', 'Erro');\n    });\n  }\n  BuscarCategorias() {\n    this.categoriaService.BuscarTodasCategorias().subscribe(result => {\n      if (result != null) {\n        this.categorias = result;\n      }\n    }, () => {\n      alert(`Nenhuma categoria encontrada. Verifique a conexão com a internet.`);\n    });\n  }\n  onFileChange(ev) {\n    const reader = new FileReader();\n    reader.onload = event => this.imagemUrl = event.target.result;\n    this.file = ev.target.files;\n    reader.readAsDataURL(this.file[0]);\n    this.uploadImagem();\n  }\n  uploadImagem() {\n    this.anuncioservice.postUpload(this.file).subscribe(fileName => {\n      this.nomeArquivo = fileName;\n    }, error => {\n      alert('Erro ao enviar imagem para o servidor.');\n    });\n  }\n  inputChange(event) {\n    const files = event.target.files;\n    this.arquivoSelecionado = files?.item(0);\n    this.anuncioservice.EnviarArquivo(this.arquivoSelecionado).subscribe(nomeArquivo => {\n      this.nomeArquivo = nomeArquivo;\n      this.localUrl = this.arquivoSelecionado;\n      console.log(this.arquivoSelecionado);\n    });\n  }\n  selectFile(event) {\n    this.file = event.target.files[0];\n    if (event.target.files && event.target.files[0]) {\n      var reader = new FileReader();\n      reader.onload = event => {\n        this.localUrl = event.target.result;\n      };\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  }\n}\nCadastrarAnuncioComponent.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CadastrarAnuncioComponent,\n  factory: CadastrarAnuncioComponent.ɵfac\n});","map":{"version":3,"mappings":"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","names":["Component","Injectable","Validators","CadastrarAnuncioComponent","constructor","fb","anuncioservice","categoriaService","toast","form","group","descricao","required","minLength","maxLength","data_validade","preco","categoria","imagem","ngOnInit","BuscarCategorias","f","controls","onChange","event","selectedFiles","srcElement","files","document","getElementById","innerHTML","name","salvarAnuncio","categoriaId","parseInt","value","empresaId","anuncio","ativo","is_destaque","categoria_id","empresa_id","imagem_url","nomeArquivo","SalvarAnuncio","subscribe","success","erro","error","BuscarTodasCategorias","result","categorias","alert","onFileChange","ev","reader","FileReader","onload","imagemUrl","target","file","readAsDataURL","uploadImagem","postUpload","fileName","inputChange","arquivoSelecionado","item","EnviarArquivo","localUrl","console","log","selectFile","factory"],"sourceRoot":"","sources":["D:\\projetos\\MarketingFront\\MarketingAppFront\\src\\app\\Components\\Anuncio\\cadastrar-anuncio\\cadastrar-anuncio.component.ts"],"sourcesContent":["import { Anuncio } from './../../../Models/Anuncio';\nimport { CategoriaService } from './../../../Services/CategoriaService';\nimport { EmpresaService } from './../../../Services/EmpresaService';\nimport { AnuncioService } from 'src/app/Services/AnuncioService';\nimport { Empresa } from './../../../Models/Empresa';\nimport { Component, Injectable, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { CategoriaAnuncio } from 'src/app/Models/CategoriaAnuncio';\nimport { ToastrService } from 'ngx-toastr';\n\n@Component({\n  selector: 'app-cadastrar-anuncio',\n  templateUrl: './cadastrar-anuncio.component.html',\n  styleUrls: ['./cadastrar-anuncio.component.css'],\n})\n\n@Injectable()\n\nexport class CadastrarAnuncioComponent implements OnInit {\n  form: FormGroup;\n  categorias: CategoriaAnuncio[] = [];\n  empresaId: number = 0;\n  categoriaId: number = 0;\n  localUrl: any;\n  file?: File;\n  nomeArquivo: string = '';\n  imagemUrl = \"../../../../assets/images/icons/upload.png\";\n  public arquivoSelecionado: File | null | undefined;\n\n  constructor(\n    private fb: FormBuilder,\n    private anuncioservice: AnuncioService,\n    private categoriaService: CategoriaService,\n    private toast: ToastrService\n  ) {\n    this.form = this.fb.group({\n      descricao: [\n        null,\n        [\n          Validators.required,\n          Validators.minLength(3),\n          Validators.maxLength(150),\n        ],\n      ],\n      data_validade: [null, [Validators.required]],\n      preco: [null, [Validators.required]],\n      categoria: [null, [Validators.required]],\n      imagem: [null, [Validators.required]],\n    });\n  }\n\n  ngOnInit(): void {\n    this.BuscarCategorias();\n  }\n\n  get f() {\n    return this.form.controls;\n  }\n\n  onChange(event: any) {\n    const selectedFiles = <FileList>event.srcElement.files;\n    document.getElementById('imageLabel')!.innerHTML = selectedFiles[0].name;\n  }\n\n  salvarAnuncio() {\n    debugger;\n    this.categoriaId = parseInt(\n      (<HTMLSelectElement>document.getElementById('categoriaId')).value\n    );\n    this.empresaId = 3;\n\n    let anuncio = {\n      descricao: this.f.descricao.value,\n      data_validade: this.f.data_validade.value,\n      preco: this.f.preco.value,\n      ativo: true,\n      is_destaque: false,\n      categoria_id: this.categoriaId,\n      empresa_id: this.empresaId,\n      imagem_url: this.nomeArquivo,\n    };\n\n    this.anuncioservice.SalvarAnuncio(anuncio)\n    .subscribe(\n      () => {\n        this.toast.success('Anúncio cadastrado com sucesso!', 'Sucesso');\n      },\n      (erro) => {\n        this.toast.error('Erro ao cadastrar o anúncio.', 'Erro');\n      }\n    );\n  }\n\n  BuscarCategorias() {\n    this.categoriaService.BuscarTodasCategorias().subscribe(\n      (result) => {\n        if (result != null) {\n          this.categorias = result;\n        }\n      },\n      () => {\n        alert(\n          `Nenhuma categoria encontrada. Verifique a conexão com a internet.`\n        );\n      }\n    );\n  }\n\n  onFileChange(ev :any) : void{\n\n    const reader = new FileReader();\n    reader.onload = (event : any) => this.imagemUrl = event.target.result;\n    this.file = ev.target.files;\n    reader.readAsDataURL(this.file[0]);\n    this.uploadImagem();\n  }\n\n  uploadImagem(): void{\n    this.anuncioservice.postUpload(this.file)\n    .subscribe(\n      (fileName) => {\n        this.nomeArquivo = fileName;\n      },\n      (error: any) => {\n        alert('Erro ao enviar imagem para o servidor.');\n      }\n    )\n  }\n\n  inputChange(event: Event) {\n    const files = (event.target as HTMLInputElement).files;\n    this.arquivoSelecionado = files?.item(0);\n    this.anuncioservice\n      .EnviarArquivo(this.arquivoSelecionado!)\n      .subscribe((nomeArquivo) => {\n        this.nomeArquivo = nomeArquivo;\n        this.localUrl = this.arquivoSelecionado;\n        console.log(this.arquivoSelecionado);\n      });\n  }\n\n  selectFile(event: any) {\n    this.file = <File>event.target.files[0];\n    if (event.target.files && event.target.files[0]) {\n      var reader = new FileReader();\n      reader.onload = (event: any) => {\n        this.localUrl = event.target.result;\n      };\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}